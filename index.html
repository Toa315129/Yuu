<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Sena125 Photobooth</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        margin: 0;
        padding: 0;
        background: #ffeaf6;
        font-family: "Arial", sans-serif;
        text-align: center;
    }

    h1 {
        color: #ff76c6;
        margin-top: 20px;
        font-size: 32px;
        font-weight: bold;
    }

    video {
        width: 92%;
        max-width: 460px;
        margin-top: 10px;
        border-radius: 18px;
        border: 5px solid #ff9fdc;
    }

    #countdown {
        font-size: 85px;
        font-weight: bold;
        height: 120px;
        margin-top: 10px;
        color: #ff3c92;
    }

    #startBtn {
        background: #ff69b4;
        color: white;
        padding: 14px 36px;
        font-size: 22px;
        border: none;
        border-radius: 14px;
        margin-top: 12px;
    }

    #downloadBtn {
        background: #ff8bcf;
        color: white;
        padding: 14px 36px;
        font-size: 22px;
        border: none;
        border-radius: 14px;
        margin-top: 25px;
        display: none;
    }

    #resultStrip img {
        width: 330px;
        margin-top: 20px;
        border-radius: 12px;
        border: 5px solid #ffa8d8;
    }
</style>
</head>
<body>

<h1>ðŸ“¸ Sena125 Photobooth ðŸŽ€</h1>

<video id="camera" autoplay playsinline></video>
<div id="countdown"></div>

<button id="startBtn">à¹€à¸£à¸´à¹ˆà¸¡à¸–à¹ˆà¸²à¸¢à¹‚à¸Ÿà¹‚à¸•à¹‰à¸šà¸¹à¸˜ ðŸ’–</button>

<canvas id="photoCanvas" style="display: none;"></canvas>
<canvas id="stripCanvas" style="display: none;"></canvas>

<div id="resultStrip"></div>

<button id="downloadBtn">à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¹‚à¸Ÿà¹‚à¸•à¹‰à¸ªà¸•à¸£à¸´à¸› ðŸŽ€</button>

<!-- à¹€à¸ªà¸µà¸¢à¸‡à¸™à¸±à¸šà¸–à¸­à¸¢à¸«à¸¥à¸±à¸‡ -->
<audio id="beepSound">
    <source src="data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAA" type="audio/mp3">
</audio>

<!-- à¹€à¸ªà¸µà¸¢à¸‡à¹à¸Šà¸° -->
<audio id="shutterSound">
    <source src="data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAA" type="audio/mp3">
</audio>

<script>
    const video = document.getElementById("camera");
    const startBtn = document.getElementById("startBtn");
    const countdownEl = document.getElementById("countdown");
    const photoCanvas = document.getElementById("photoCanvas");
    const stripCanvas = document.getElementById("stripCanvas");
    const resultStripDiv = document.getElementById("resultStrip");
    const downloadBtn = document.getElementById("downloadBtn");

    const beep = document.getElementById("beepSound");
    const shutter = document.getElementById("shutterSound");

    // à¹€à¸›à¸´à¸”à¸à¸¥à¹‰à¸­à¸‡
    (async function() {
        const stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "user" },
            audio: false
        });
        video.srcObject = stream;
    })();

    // à¸™à¸±à¸šà¸–à¸­à¸¢à¸«à¸¥à¸±à¸‡
    async function countdown(sec) {
        for (let i = sec; i > 0; i--) {
            countdownEl.textContent = i;
            beep.play();
            await new Promise(res => setTimeout(res, 1000));
        }
        countdownEl.textContent = "";
    }

    // à¸–à¹ˆà¸²à¸¢à¸£à¸¹à¸›
    async function takePhoto() {
        const ctx = photoCanvas.getContext("2d");
        photoCanvas.width = video.videoWidth;
        photoCanvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0);

        shutter.play();
        return photoCanvas.toDataURL("image/png");
    }

    startBtn.onclick = async () => {
        startBtn.style.display = "none";
        resultStripDiv.innerHTML = "";
        downloadBtn.style.display = "none";

        const photos = [];

        // à¸–à¹ˆà¸²à¸¢ 4 à¸£à¸¹à¸›
        for (let i = 0; i < 4; i++) {
            await countdown(3);
            let shot = await takePhoto();
            photos.push(shot);
        }

        createStrip(photos);
    };

    // à¸£à¸§à¸¡à¹‚à¸Ÿà¹‚à¸•à¹‰à¸ªà¸•à¸£à¸´à¸›
    function createStrip(photos) {
        const W = 650;
        const H = 1650;

        stripCanvas.width = W;
        stripCanvas.height = H;

        const ctx = stripCanvas.getContext("2d");

        // à¸žà¸·à¹‰à¸™à¸«à¸¥à¸±à¸‡à¹‚à¸—à¸™à¸«à¸§à¸²à¸™
        ctx.fillStyle = "#ffd6f0";
        ctx.fillRect(0, 0, W, H);

        // à¸à¸£à¸­à¸šà¹ƒà¸«à¸à¹ˆ
        ctx.fillStyle = "#ff8bcf";
        ctx.fillRect(40, 40, W - 80, H - 80);

        const imgW = W - 140;
        const imgH = 300;

        let top = 60;

        photos.forEach((src) => {
            const img = new Image();
            img.src = src;
            img.onload = () => {
                ctx.drawImage(img, 70, top, imgW, imgH);
            };
            top += imgH + 25;
        });

        // à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡
        ctx.fillStyle = "#ffffff";
        ctx.font = "bold 52px Arial";
        ctx.textAlign = "center";
        ctx.fillText("sena125", W / 2, H - 55);

        setTimeout(() => {
            const finalImg = stripCanvas.toDataURL("image/png");

            const imgElement = document.createElement("img");
            imgElement.src = finalImg;
            resultStripDiv.appendChild(imgElement);

            downloadBtn.style.display = "block";
            downloadBtn.onclick = () => {
                const a = document.createElement("a");
                a.href = finalImg;
                a.download = "sena125-photostrip.png";
                a.click();
            };
        }, 500);
    }
</script>

</body>
</html>
